{"version":3,"file":"options.mjs","sourceRoot":"","sources":["../src/options.ts"],"names":[],"mappings":"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","sourcesContent":["import { platform } from 'node:os';\nimport { argv, stdout } from 'node:process';\nimport yargs from 'yargs/yargs';\n\nimport {\n  type Checksums,\n  type ParsedOptions,\n  type ArchitecturesTuple,\n  type BinariesTuple,\n  type PlatformsTuple,\n  Architecture,\n  Binary,\n  Platform,\n} from './types';\nimport { normalizeSystemArchitecture } from './utils';\n\n/**\n * Type guard to check if a string is a valid version string starting with 'v'.\n *\n * @param value - The string to check\n * @returns True if the string is a valid version string\n */\nfunction isVersionString(value: string): value is `v${string}` {\n  return /^v\\d/u.test(value);\n}\n\n/**\n * Prints the Foundry banner to the console.\n */\nexport function printBanner() {\n  console.log(`\n.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx\n\n ╔═╗ ╔═╗ ╦ ╦ ╔╗╔ ╔╦╗ ╦═╗ ╦ ╦         Portable and modular toolkit\n ╠╣  ║ ║ ║ ║ ║║║  ║║ ╠╦╝ ╚╦╝    for Ethereum Application Development\n ╚   ╚═╝ ╚═╝ ╝╚╝ ═╩╝ ╩╚═  ╩                 written in Rust.\n\n.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx\n\nRepo       : https://github.com/foundry-rs/\nBook       : https://book.getfoundry.sh/\nChat       : https://t.me/foundry_rs/\nSupport    : https://t.me/foundry_support/\nContribute : https://github.com/orgs/foundry-rs/projects/2/\n\n.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx.xOx\n`);\n}\n\n/**\n * Parses command line arguments and returns the parsed options.\n *\n * @param args - Command line arguments to parse\n * @returns Parsed command line arguments\n */\nexport function parseArgs(args: string[] = argv.slice(2)) {\n  const { $0, _, ...parsed } = yargs()\n    // Ensure unrecognized commands/options are reported as errors.\n    .strict()\n    // disable yargs's version, as it doesn't make sense here\n    .version(false)\n    // use the scriptName in `--help` output\n    .scriptName('yarn foundryup')\n    // wrap output at a maximum of 120 characters or `stdout.columns`\n    .wrap(Math.min(120, stdout.columns))\n    .parserConfiguration({\n      'strip-aliased': true,\n      'strip-dashed': true,\n    })\n    // enable ENV parsing, which allows the user to specify foundryup options\n    // via environment variables prefixed with `FOUNDRYUP_`\n    .env('FOUNDRYUP')\n    .command(['$0', 'install'], 'Install foundry binaries', (builder) => {\n      builder.options(getOptions()).pkgConf('foundryup');\n    })\n    .command('cache', '', (builder) => {\n      builder.command('clean', 'Remove the shared cache files').demandCommand();\n    })\n    .parseSync(args);\n\n  const command = _.join(' ');\n  if (command === 'cache clean') {\n    return {\n      command,\n    } as const;\n  }\n\n  // if we get here `command` is always 'install' or '' (yargs checks it)\n  return {\n    command: 'install',\n    options: parsed as ParsedOptions<ReturnType<typeof getOptions>>,\n  } as const;\n}\n\nconst Binaries = Object.values(Binary) as BinariesTuple;\n\n/**\n * Returns the command line options configuration.\n *\n * @param defaultPlatform - Default platform to use\n * @param defaultArch - Default architecture to use\n * @returns Command line options configuration\n */\nfunction getOptions(\n  defaultPlatform = platform(),\n  defaultArch = normalizeSystemArchitecture(),\n) {\n  return {\n    binaries: {\n      alias: 'b',\n      type: 'array' as const,\n      multiple: true,\n      description: 'Specify the binaries to install',\n      default: Binaries,\n      choices: Binaries,\n      coerce: (values: Binary[]): Binary[] => [...new Set(values)], // Remove duplicates\n    },\n    checksums: {\n      alias: 'c',\n      description: 'JSON object containing checksums for the binaries.',\n      coerce: (rawChecksums: string | Checksums): Checksums => {\n        try {\n          return typeof rawChecksums === 'string'\n            ? JSON.parse(rawChecksums)\n            : rawChecksums;\n        } catch {\n          throw new Error('Invalid checksums');\n        }\n      },\n      optional: true,\n    },\n    repo: {\n      alias: 'r',\n      description: 'Specify the repository',\n      default: 'foundry-rs/foundry',\n    },\n    version: {\n      alias: 'v',\n      description:\n        'Specify the version (see: https://github.com/foundry-rs/foundry/tags)',\n      default: 'nightly',\n      coerce: (\n        rawVersion: string,\n      ): { version: 'nightly' | `v${string}`; tag: string } => {\n        if (rawVersion.startsWith('nightly')) {\n          return { version: 'nightly', tag: rawVersion };\n          // we don't validate the version much, we just trust the user\n        } else if (isVersionString(rawVersion)) {\n          return { version: rawVersion, tag: rawVersion };\n        }\n        throw new Error('Invalid version');\n      },\n    },\n    arch: {\n      alias: 'a',\n      description: 'Specify the architecture',\n      // if `defaultArch` is not a supported Architecture yargs will throw an error\n      default: defaultArch as Architecture,\n      choices: Object.values(Architecture) as ArchitecturesTuple,\n    },\n    platform: {\n      alias: 'p',\n      description: 'Specify the platform',\n      // if `defaultPlatform` is not a supported Platform yargs will throw an error\n      default: defaultPlatform as Platform,\n      choices: Object.values(Platform) as PlatformsTuple,\n    },\n  };\n}\n"]}